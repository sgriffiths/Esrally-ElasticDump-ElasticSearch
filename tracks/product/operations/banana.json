{
  "name": "product_search_banana",
  "operation-type": "search",
  "body": {
    "from": 0,
    "size": 36,
    "explain": false,
    "sort": [
      {
        "_score": {
          "order": "desc"
        }
      },
      {
        "volumesize.raw": {
          "order": "asc"
        }
      },
      {
        "aisle.raw": {
          "order": "asc"
        }
      },
      {
        "aisledisplayorder_alpha.raw": {
          "order": "asc"
        }
      },
      {
        "productgroupdisplayorder.displayorder.raw": {
          "order": "desc",
          "nested_path": "productgroupdisplayorder"
        }
      },
      {
        "deptid.raw": {
          "order": "desc"
        }
      }
    ],
    "_source": {
      "includes": [
        "stockcode",
        "special",
        "shelfgroupkey",
        "shelfgroupid",
        "term"
      ],
      "excludes": [
        "price",
        "supplylimit",
        "priceexception",
        "suggest",
        "productgroupdisplayorder"
      ]
    },
    "aggs": {
      "Brand-filter": {
        "filter": {},
        "aggs": {
          "Brand": {
            "terms": {
              "field": "pies_brand.raw",
              "size": 10000,
              "order": [
                {
                  "_term": "asc"
                }
              ]
            }
          }
        }
      },
      "Category-filter": {
        "filter": {},
        "aggs": {
          "Category-nested": {
            "nested": {
              "path": "categories"
            },
            "aggs": {
              "Category-nested-filter": {
                "filter": {},
                "aggs": {
                  "Category": {
                    "terms": {
                      "field": "categories.nodeid.raw",
                      "size": 10000,
                      "order": [
                        {
                          "_term": "asc"
                        }
                      ]
                    },
                    "aggs": {
                      "Category-filter-description": {
                        "terms": {
                          "field": "categories.description.raw",
                          "size": 1
                        }
                      },
                      "Category-filter-displayorder": {
                        "terms": {
                          "field": "categories.displayorder.raw",
                          "size": 1
                        }
                      },
                      "Category-filter-isrestricted": {
                        "terms": {
                          "field": "categories.isrestricted",
                          "size": 1
                        }
                      },
                      "Category-filter-nodelevel": {
                        "terms": {
                          "field": "categories.nodelevel.raw",
                          "size": 1
                        }
                      },
                      "Category-filter-parentnodeid": {
                        "terms": {
                          "field": "categories.parentnodeid.raw",
                          "size": 1
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "query": {
      "function_score": {
        "query": {
          "bool": {
            "must": [
              {
                "bool": {
                  "should": [
                    {
                      "bool": {
                        "boost": 1.0,
                        "must": [
                          {
                            "multi_match": {
                              "boost": 1.0,
                              "type": "cross_fields",
                              "query": "banana",
                              "operator": "and",
                              "fields": [
                                "barcode^1",
                                "searchtags^1",
                                "agerestricted^1",
                                "brand^1",
                                "volumesize^3",
                                "sapdepartmentno^1",
                                "sapsegmentname^4",
                                "sapsegmentno^1",
                                "sapsubcategoryno^1",
                                "aisleid^1",
                                "deptid^1",
                                "shelfid^1",
                                "sapcategoryname^1",
                                "sapsubcategoryname^1",
                                "shelf^1",
                                "dept^1",
                                "shelfgroupid^1",
                                "aisledisplayorder_beta^1",
                                "categorydisplayorder_beta^1",
                                "stockcode^1",
                                "lifestyle_claim^1",
                                "wool_dietaryclaim^1",
                                "pies_brand^1"
                              ]
                            }
                          }
                        ]
                      }
                    },
                    {
                      "bool": {
                        "boost": 1.0,
                        "must": [
                          {
                            "bool": {
                              "should": [
                                {
                                  "wildcard": {
                                    "numberoftimespurchased": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "agerestricted": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "aisle": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapcategoryname": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapsubcategoryname": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "dept": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "deptid": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "shelfid": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapsegmentname": {
                                      "boost": 4.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapdepartmentno": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapsegmentno": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapsubcategoryno": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "lifestyle_claim": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "wool_dietaryclaim": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "pies_brand": {
                                      "boost": 1.0,
                                      "value": "banana*"
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ]
                      }
                    },
                    {
                      "bool": {
                        "boost": 1.0,
                        "must": [
                          {
                            "multi_match": {
                              "boost": 1.0,
                              "type": "cross_fields",
                              "query": "banana",
                              "analyzer": "standard_autocorrect",
                              "operator": "and",
                              "fields": [
                                "barcode^1",
                                "agerestricted^1",
                                "perishablecode^1",
                                "volumesize^1",
                                "sapdepartmentno^1",
                                "sapsegmentname^1",
                                "sapsegmentno^1",
                                "sapsubcategoryno^1",
                                "aisleid^1",
                                "deptid^1",
                                "shelfid^1",
                                "sapcategoryname^1",
                                "sapsubcategoryname^1",
                                "shelf^1",
                                "dept^1",
                                "shelfgroupid^1",
                                "lifestyle_claim^1"
                              ]
                            }
                          }
                        ]
                      }
                    },
                    {
                      "bool": {
                        "boost": 1.0,
                        "must": [
                          {
                            "bool": {
                              "should": [
                                {
                                  "wildcard": {
                                    "barcode": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "numberoftimespurchased": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "aisle": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapdepartmentno": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapsubcategoryno": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "dept": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "deptid": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "shelf": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "perishablecode": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "boxed_contents": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "volumesize": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapsegmentname": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapsegmentno": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "sapsegmentno": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "aisleid": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "shelfid": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "shelfgroupid": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "lifestyle_claim": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                },
                                {
                                  "wildcard": {
                                    "wool_dietaryclaim": {
                                      "boost": 1.0,
                                      "value": "*banana"
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        ]
                      }
                    },
                    {
                      "multi_match": {
                        "boost": 1.0,
                        "type": "phrase",
                        "query": "banana",
                        "operator": "or",
                        "fields": [
                          "shelf^1",
                          "aisle^1",
                          "barcode^1",
                          "stockcode^1",
                          "sapcategoryname^1",
                          "sapdepartmentname^1",
                          "sapsegmentname^1",
                          "sapsubcategoryname^1",
                          "dept^1",
                          "aisleid^1",
                          "brand^1",
                          "deptid^1",
                          "healthstarrating^1",
                          "lifestyle_claim^1",
                          "perishablecode^1",
                          "sapcategoryno^1",
                          "sapdepartmentno^1",
                          "sapsegmentno^1",
                          "sapsubcategoryno^1",
                          "searchtags^1",
                          "shelfid^1",
                          "wool_dietaryclaim^1",
                          "volumesize^1",
                          "basedescription^1",
                          "displayname^1"
                        ]
                      }
                    }
                  ]
                }
              }
            ],
            "filter": [
              {
                "exists": {
                  "field": "stockcode"
                }
              },
              {
                "bool": {
                  "must": [
                    {
                      "bool": {
                        "should": [
                          {
                            "term": {
                              "isbundle": {
                                "value": 0
                              }
                            }
                          },
                          {
                            "bool": {
                              "must_not": [
                                {
                                  "exists": {
                                    "field": "isbundle"
                                  }
                                }
                              ]
                            }
                          },
                          {
                            "term": {
                              "webenable": {
                                "value": "true"
                              }
                            }
                          }
                        ]
                      }
                    },
                    {
                      "nested": {
                        "query": {
                          "bool": {
                            "must": [
                              {
                                "term": {
                                  "price.fulfilmentstoreid": {
                                    "value": "1649"
                                  }
                                }
                              }
                            ]
                          }
                        },
                        "path": "price"
                      }
                    }
                  ],
                  "must_not": [
                    {
                      "range": {
                        "agerestricted.raw": {
                          "gt": 2147483647.0,
                          "lt": 2147483647.0
                        }
                      }
                    },
                    {
                      "nested": {
                        "query": {
                          "bool": {
                            "must": [
                              {
                                "terms": {
                                  "productgroupdisplayorder.productgroupid": []
                                }
                              }
                            ]
                          }
                        },
                        "path": "productgroupdisplayorder"
                      }
                    },
                    {
                      "exists": {
                        "field": "shelfgroupid"
                      }
                    },
                    {
                      "nested": {
                        "query": {
                          "bool": {
                            "must": [
                              {
                                "terms": {
                                  "categories.nodeid.raw": [
                                    "1_5D1DC54",
                                    "1_5F7F818",
                                    "1_6041D22",
                                    "1_642B716",
                                    "1_86F606C",
                                    "1_89BB9C0",
                                    "1_B02B02B",
                                    "1_B63CF9E"
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        "path": "categories"
                      }
                    },
                    {
                      "terms": {
                        "deptid": []
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        "functions": [
          {
            "filter": {
              "term": {
                "dept": {
                  "value": "banana"
                }
              }
            },
            "weight": 26.0
          },
          {
            "filter": {
              "term": {
                "dept": {
                  "value": "bananas"
                }
              }
            },
            "weight": 13.0
          },
          {
            "filter": {
              "term": {
                "aisle": {
                  "value": "banana"
                }
              }
            },
            "weight": 24.0
          },
          {
            "filter": {
              "term": {
                "aisle": {
                  "value": "bananas"
                }
              }
            },
            "weight": 12.0
          },
          {
            "filter": {
              "term": {
                "shelf": {
                  "value": "banana"
                }
              }
            },
            "weight": 22.0
          },
          {
            "filter": {
              "term": {
                "shelf": {
                  "value": "bananas"
                }
              }
            },
            "weight": 11.0
          },
          {
            "filter": {
              "term": {
                "brand": {
                  "value": "banana"
                }
              }
            },
            "weight": 20.0
          },
          {
            "filter": {
              "term": {
                "brand": {
                  "value": "bananas"
                }
              }
            },
            "weight": 10.0
          },
          {
            "filter": {
              "term": {
                "genericproductname": {
                  "value": "banana"
                }
              }
            },
            "weight": 20.0
          },
          {
            "filter": {
              "term": {
                "genericproductname": {
                  "value": "bananas"
                }
              }
            },
            "weight": 10.0
          },
          {
            "filter": {
              "term": {
                "variety": {
                  "value": "banana"
                }
              }
            },
            "weight": 20.0
          },
          {
            "filter": {
              "term": {
                "variety": {
                  "value": "bananas"
                }
              }
            },
            "weight": 10.0
          }
        ],
        "score_mode": "sum",
        "boost_mode": "replace"
      }
    }
  }
}